"use strict";function debounce(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=void 0;return function(){for(var i=this,o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];r?clearTimeout(r):n&&t.apply(this,a),r=setTimeout(function(){n||t.apply(i,a),r=0},e)}}function findWarning(t,e){var n=t.name,r=t.type,i=[];return e.forEach(function(t){config[r].indexOf(t)!==-1?i.push(t):console.error('Warning: field named "'+n+'" with type="'+r+'". data-options can not contain check to "'+t+'"')}),i}function checkValue(t,e){for(var n=Object.keys(t).length,r=function(n){var r=t[n],i=r.input,o=r.config,a="instructions-"+r.lang,u="",s=function(t){var e=types[t];if(e){var n=e.validate(i);if(n)return!1;var r=e[a];return u=r,!0}return!1};o&&o.some(s),e.set(i,u)},i=0;i<n;i++)r(i);return e}function sortGroups(t){var e=[];t.forEach(function(t){var n=sortForName(t);e.indexOf(n)===-1&&e.push(n)});var n=[];return e.forEach(function(e){var r=forEachGroup(e,t);n.push(r)}),n}function forEachGroup(t,e){var n=[];return e.forEach(function(e){var r=sortForName(e);return t===r&&(n.push(e),!0)}),n}function sortForName(t){var e=t.type,n=void 0;if("radio"===e)n=t.name;else if("checkbox"===e){var r=t.dataset.groupname;r&&(n=r)}return n}function checkValueGroup(t,e){return t.forEach(function(t){var n=getMessage$1(t);e.set(t[0],n)}),e}function getMessage$1(t){var e="instructions-en",n="",r=function(r){var i=types.isEmptyGroup;if(i){var o=i.validate(t);if(o)return!1;var a=i[e];return n=a,!0}return!1};return t.some(r),n}function validation$1(){var t=document.querySelectorAll("form[data-validation=true]");initValidation(t)}function initValidation(t){Array.prototype.forEach.call(t,function(t){new Validation(t)})}function main(){validation$1()}var types={isNonEmpty:{validate:function(t){return""!==t.value},"instructions-ru":"это поле не может быть пустым.","instructions-en":"This field can not be empty."},onlyLetters:{validate:function(t){return!/[^a-zа-яё ]/gi.test(t.value)},"instructions-ru":'значением может быть только буквы от "а" до "я".',"instructions-en":'value can only be the letters "a" to "z".'},isValidNumber:{validate:function(t){return!isNaN(t.value)},"instructions-ru":"значением может быть только число­, например 1, 3.14 или 2010","instructions-en":"value can only be a number, such as 1, 3.14 or 2010"},minMax:{validate:function(t){var e=Number(t.min),n=Number(t.max),r=Number(t.value);return!(e>r||r>n)},"instructions-ru":"значением может быть только число не меньше min и не больше max","instructions-en":"value can only be a number no less and no more than min max"},min:{validate:function(t){var e=Number(t.min),n=Number(t.value);return!(e>n)},"instructions-ru":"значением может быть только число не меньше min","instructions-en":"value can only be a number not less than min"},max:{validate:function(t){var e=Number(t.max),n=Number(t.value);return!(n>e)},"instructions-ru":"значением может быть только число не больше max","instructions-en":"value can only be a number not more than max"},isEmailCorrect:{validate:function(t){return/^.+@.+$/.test(t.value)},"instructions-ru":"введите корректный email","instructions-en":"enter a valid email"},isValidTel:{validate:function(t){return!/[^0-9 .()*+-]/g.test(t.value)},"instructions-ru":"введите корректный телефон","instructions-en":"enter a valid phone"},isValidUrl:{validate:function(t){return/^(https?|s?ftp|file):\/\/[a-zа-яё_-]+[\a-zа-яё\.]{2,6}\??([a-zа-яё_-]+)\#?([a-zа-яё_-]+)/g.test(t.value)},"instructions-ru":"введите корректный url","instructions-en":"enter a valid url"},isRequired:{validate:function(t){return t.checked},"instructions-ru":"для продолжения активируйте обязательное поле","instructions-en":"for to continue activate a mandatory field"},isEmptyGroup:{validate:function(t){var e=t.some(function(t){return!!t.checked});return e},"instructions-ru":"необходимо выбрать хоть один пункт","instructions-en":"you need to select at least one item"}},config={text:["isNonEmpty","onlyLetters"],number:["isNonEmpty","isValidNumber","minMax","min","max"],email:["isNonEmpty","isEmailCorrect"],password:["isNonEmpty"],file:["isNonEmpty"],search:["isNonEmpty","onlyLetters"],tel:["isNonEmpty","isValidTel"],url:["isNonEmpty","isValidUrl"],checkbox:["isRequired","group"],radio:["isRequired","group"]},checkAttrGroup=function(t){return"group"===t},asyncGenerator=function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,i){var u={key:t,arg:e,resolve:n,reject:i,next:null};a?a=a.next=u:(o=a=u,r(t,e))})}function r(n,o){try{var a=e[n](o),u=a.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):i(a.done?"return":"normal",a.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):a=null}var o,a;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),get=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},set=function t(e,n,r,i){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);null!==a&&t(a,n,r,i)}else if("value"in o&&o.writable)o.value=r;else{var u=o.set;void 0!==u&&u.call(i,r)}return r},OutputErrors=function(){function t(){classCallCheck(this,t),this.storeCreateElements=new Map,this.errorNotificationElement=Object.create(null)}return createClass(t,[{key:"sortMessages",value:function(t){var e=this,n=t.keys().next().value,r=n.closest("form");t.forEach(function(t,n,r){var i=n,o=t;o?e.storeCreateElements.has(i)?e.storeCreateElements.get(i).message!==o&&(e.storeCreateElements.get(i).newElement.textContent=o,e.storeCreateElements.get(i).message=o):(e.errorNotificationElement={newElement:e.createErrorElement(i,o),message:o},e.storeCreateElements.set(i,e.errorNotificationElement)):e.storeCreateElements.has(i)&&!function(){var t=e.storeCreateElements.get(i).newElement;t.classList.add("hide"),setTimeout(function(){i.parentElement.removeChild(t),e.storeCreateElements.delete(i)},100)}()}),0===this.storeCreateElements.size&&r.submit()}},{key:"createErrorElement",value:function(t,e){var n=document.createElement("span");return n.classList.add("notify"),setTimeout(function(){return n.classList.add("show")},0),n.textContent=e,t.parentElement.insertBefore(n,t),n}}]),t}(),Store=function(){function t(){classCallCheck(this,t),this.outputErrors=new OutputErrors}return createClass(t,[{key:"getMessage",value:function(t){this.outMessage(t)}},{key:"outMessage",value:function(t){this.outputErrors.sortMessages(t)}}]),t}(),Validation=function(){function t(e){classCallCheck(this,t),this.form=e,this.listInputElement=e.querySelectorAll("input[type=text], input[type=number], input[type=email], input[type=password], input[type=file], \n\t\t\tinput[type=search], input[type=tel], input[type=url], input[type=checkbox], input[type=radio]"),this.store=new Store,this.storeErrors=new Map,this.groupsElements=[],this.dataInput=Object.create(null),this.isFirst=!0,this.registerHandlers()}return createClass(t,[{key:"registerHandlers",value:function(){var t=this;this.init(),this.form.addEventListener("submit",function(e){return t.validation(e)})}},{key:"init",value:function(){var t=this,e=document.documentElement.lang,n=[],r=[];Array.prototype.filter.call(this.listInputElement,function(t){var e=t.dataset.options;if(e){if("radio"===t.type||"checkbox"===t.type){var i=e.split(" "),o=(findWarning(t,i),i.some(checkAttrGroup));return o?(r.push(t),!0):(n.push(t),!1)}return n.push(t),!1}}),this.groupsElements=sortGroups(r),n.forEach(function(n,r){var i=n.dataset.options,o=void 0;if(i){var a=i.split(" ");o=findWarning(n,a)}t.dataInput[r]={input:n,name:n.name,config:o,lang:e}})}},{key:"validation",value:function(t){var e=this;t.preventDefault();var n=checkValue(this.dataInput,this.storeErrors);n=checkValueGroup(this.groupsElements,this.storeErrors),this.store.getMessage(n),this.isFirst&&(this.form.addEventListener("input",debounce(function(t){return e.validation(t)},100,!0)),this.form.addEventListener("change",debounce(function(t){return e.validation(t)},100,!0)),this.isFirst=!1)}}]),t}();module.exports=main;
